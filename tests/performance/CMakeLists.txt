#==============================================================================
#  DEFINE THE TARGETS AND TESTS
#==============================================================================

add_executable (pioperf EXCLUDE_FROM_ALL
                pioperformance.F90)
add_executable (perftest EXCLUDE_FROM_ALL
                perftest.c)
target_link_libraries (pioperf piof)
add_dependencies (tests pioperf perftest)

if ("${CMAKE_Fortran_COMPILER_ID}" STREQUAL "GNU")
    target_compile_options (pioperf
        PRIVATE -ffree-line-length-none)
endif()

if (CMAKE_Fortran_COMPILER_ID STREQUAL "NAG")
   set ( CMAKE_Fortran_FLAGS "${CMAKE_Fortran_FLAGS} -mismatch_all" )
#    target_compile_options (gptl
#        PRIVATE -mismatch_all)
endif ()

if (PIO_HDF5_LOGGING) 
    target_compile_definitions (pioperf 
        PUBLIC LOGGING)
endif ()

if (PIO_HDF5_LOGGING) 
    target_compile_definitions (perftest
        PUBLIC LOGGING)
endif ()

#===== MPE =====
find_package (MPE "2.4.8" COMPONENTS C)
if (MPE_C_FOUND)
    target_include_directories (perftest
        PUBLIC ${MPE_C_INCLUDE_DIRS})
    target_compile_definitions (perftest
        PUBLIC _MPE)
    target_link_libraries (perftest pioc lmpe mpe pthread m)
else ()
    target_compile_definitions (perftest
        PUBLIC _NOMPE)
endif ()

